#!/bin/sh

# SYNOPSIS
#   workspacerc - workspace init file for x sessions
#   also see xinitrc

[ -n "${DEBUG-}" ] && set -xv

set -eu

script="${0##*/}"
session=${1:-workspace}

test -r ~/.profile && . ~/.profile

logfile="$TMP/$script.log"
exec > "$logfile" 2>&1

log() {
  echo >&2 "$(date +%FT%T.%N) $script '$*' $$ $PPID : $*"
}

launch() {
  cmd="$1"; shift;
  if ! killall -0 "$cmd"; then
    if type "$cmd"; then
      log "launching '$cmd' '$*'"
      "$cmd" "$@" &
    fi
  fi
}

# NOTE
# Also see .xinitrc for daemons started early before the desktop environment
{
  log "Starting session '$session'"

  i3-layout-manager -a

  wpset &

  pgrep -f mark_last_window || mark_last_window &

  unclutter  -idle 5 &
  autocutsel --fork &
  copyq &
  laptop-detect && numlockx off &

  launch xflux -l 48.1439 -g 17.1097 &

  launch firefox >/dev/null 2>&1 &
  launch evolution >/dev/null 2>&1 &
  launch spotify &
  launch slack &

  nice -n 0 urxvtd -q -f -o &
  launch qterm &

  xrandr --dpi 96

  sleep 10 && ~/.config/xsetrc
}
